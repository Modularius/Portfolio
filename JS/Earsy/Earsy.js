(function(){xmlCache={_src:{"courses":"XML/French/French.xml","lessons":"XML/French/Lessons.xml","quick":"XML/French/QuickLesson.xml","vocab":"XML/French/Vocab.xml"},get:function(name,callback){if(typeof xmlCache[name]=="undefined")$.get(this._src[name],function(xml){xmlCache[name]=xml;callback(xmlCache[name])});else callback(xmlCache[name])}}})();(function(){vocalGood="";vocalBad="";letters=["a","b","c","d","e"];GLOBAL_VARIABLES={voiceSpeed:0.9,voiceSpeedSlow:0.55};ttsChrome=function(text,speed){if(typeof speed=="undefined")speed=GLOBAL_VARIABLES.voiceSpeed;var voices=window.speechSynthesis.getVoices();var msg=new SpeechSynthesisUtterance(text);msg.voice=voices[7];msg.rate=speed;msg.lang="fr";window.speechSynthesis.speak(msg)};createBlock=function(letter,content){return content.appendTo($("<div></div>")).attr("class","ui-block-"+letter)};
createCard=function(title,content){var head=$('<div class = "ui-bar ui-bar-a">'+title+"</div>");var body=$('<div class = "ui-body ui-body-a"></div>').append(content);return $('<div class = "ui-corners-all-a custom-corners" style = "padding: 1em"></div>').append(head).append(body)};appendTempPage=function(pagetype,id){if(pagetype=="module"){$("body").append($("<div data-role = 'page'></div>").attr("id","module_"+id).attr("class","modulePage"));$(document).on("pagebeforeshow","#module_"+id,function(event,
data){$("#M-id").val(id);$(":mobile-pagecontainer").pagecontainer("change","#module",{changeHash:false,transition:"none"})})}else if(pagetype=="lesson"){$("body").append($("<div data-role = 'page'></div>").attr("id","lesson_"+id).attr("class","lessonPage"));$(document).on("pagebeforeshow","#lesson_"+id,function(event,data){$("#L-id").val(id);$(":mobile-pagecontainer").pagecontainer("change","#lesson",{changeHash:false,transition:"none"})})}};ifExistsElse=function(theTry,theElse){if(typeof theTry!=
"undefined")return theTry;else return theElse};$.prototype.filterWithAttr=function(obj,attribute){if(typeof obj.attr(attribute)=="undefined")return this;else return this.filter("["+attribute+" = '"+obj.attr(attribute)+"']")};$.prototype.filterWithClass=function(obj,attribute){if(typeof obj.attr(attribute)=="undefined")return this;else return this.filter("."+obj.attr(attribute))};selectRandomInteger=function(from,to){return Math.floor(Math.random()*(to-from)+from)};selectRandomArrayElem=function(arr){return arr[selectRandomInteger(0,
arr.length)]};createPool=function(base,replace){if(base)if(replace)return function(){return selectRandomArrayElem(base)};else{var pool=base.slice(0);return function(){return pool.splice(selectRandomInteger(0,pool.length),1)}}};getCategoriesSelectString=function(xml){if($(xml).attr("categories")=="")return $(xml).attr("wordtype");var arr=Array();$($(xml).attr("categories").split(" ")).each(function(index){arr.push($(xml).attr("wordtype")+"[category*="+this+"]")});return arr.join(",")};animateColour=
function(jObj,toCol,time,itrs){var index=0;var fromCol=jObj.css("color");var iterate=function(){var cur=fromCol+(toCol-fromCol)*index/itrs;jObj.css("color",cur);index=index+1;if(index<itrs)setTimeout(iterate,time/itrs)}()}})();(function(){$(document).ready(function(){ttsChrome("");loadUserData();initTitles();initQuickLesson();setupUserDisplay();$(document).on("pagebeforeshow","#courselist",function(event,data){xmlCache.get("courses",function(xml){populateCourseList(xml);$("#courselist").trigger("create")})});$(document).on("pagebeforeshow","#module",function(event,data){$("div.modulePage").remove();$("div.lessonPage").remove();xmlCache.get("courses",function(xml){populateModulePage(xml,$("#M-id").val());$("#module").trigger("create")})});
$(document).on("pagebeforeshow","#lesson",function(event,data){$("div.modulePage").remove();$("div.lessonPage").remove();xmlCache.get("lessons",function(xml){populateLesson(xml,$("#L-id").val());$("#lesson").trigger("create")})});processHashForModuleOrLesson()});var processHashForModuleOrLesson=function(){var hash=location.hash;switch(hash.substr(0,8)){case "#module_":$("#M-id").val(hash.substring(8,hash.length));$(":mobile-pagecontainer").pagecontainer("change","#module",{changeHash:false,transition:"none"});
break;case "#lesson_":$("#L-id").val(hash.substring(8,hash.length));$(":mobile-pagecontainer").pagecontainer("change","#lesson",{changeHash:false,transition:"none"});break;default:break}};function initTitles(){$("div.placeholder-title").each(function(){var pagetitle=$(this).text();$(this).html("<H1>Earsy Language Learning</H1> <h2 class = 'pagetitle'>"+pagetitle+"</h2>")});$("span.apptitle").text("Earsy");$("div.placeholder-copywrite").text("(c) Daniel Kirk 2016");$("div.placeholder-copywrite").attr("style",
"text-align:center;font-size:75%;padding-bottom:10px;");$("div.stat-board").html("<div><div style = 'display:inline;padding-left:10px;'>User: <span class = 'username'></span> </div><div style = 'float:right;display:inline;padding-right:10px;'>Language: <span class = 'languagename'></span> </div></div>");$("div.stat-board").attr("style","font-size:75%;text-align:left;font-weight:normal;padding-bottom:10px;");$("div.navbar-min").html("<div class = 'ui-body'><div data-role = 'navbar'><ul><li><a href = '#welcome' class = 'ui-btn'>Back To Front Screen</a></li></ul></div></div>");
$("div.navbar-full").html("<div class = 'ui-body'><div data-role = 'navbar'><ul><li><a href = '#mainmenu' class = 'ui-btn'>Back</a></li><li><a href = '#welcome' class = 'ui-btn'>Back To Front Screen</a></li></ul></div></div>")}function setupUserDisplay(){$("span.username").text("Daniel Kirk");$("span.languagename").text("French")}})();(function(){TEMPLATE_USER_LESSON={score:0,timesCompleted:0,timesAttempted:0};USER={score:0};loadUserData=function(){var temp=localStorage.getItem("EarsyUserData");if(temp!==null){console.log(temp);USER=JSON.parse(temp)}};saveUserData=function(){localStorage.setItem("EarsyUserData",JSON.stringify(USER))}})();(function(){populateLesson=function(xml,id){var lessonID="lesson_"+id;var populateWithLesson=function(xml){$("#lessonInfoBox-title").text($(xml).attr("name"));$("#lessonInfoBox-details").text($(xml).attr("details"));$(xml).find("exercise").each(function(index){switch($(this).attr("type")){case "learn":createLearn(this);break;case "quiz":createQuiz(this);break;case "conversation":createConvo(this,index);break}});USER[lessonID].timesAttempted=USER[lessonID].timesAttempted+1;saveUserData();var parentModuleID=
$(xml).attr("parent");$("#L-backToModule").attr("href","#module_"+parentModuleID);appendTempPage("module",parentModuleID)};xmlCache.get("vocab",function(){$("#VL-lesson").empty();populateWithLesson($(xml).find("lesson#"+id));$("button.VL-playfrench").on("click",function(){ttsChrome($(this).attr("value"))})})};var createLearn=function(xml){var createLearnList=function(listdiv,xml){var count=parseInt($(xml).attr("count"));for(i=0;i<count;i++){var ctrlGrp=$('<div data-role = "controlgroup" data-type = "vertical" class = ""></div>').append($('<button class = "VL-playfrench learnlist-button"></button>'));
$("<div></div>").attr("class","ui-block-"+letters[i%3]).append(ctrlGrp).appendTo(listdiv)}};var setLearnList=function(div,xml){var count=parseInt($(xml).attr("count"));var list=$(xml).find("learnlist");var selectString=getCategoriesSelectString(list);var sampleFromPool=createPool($(xmlCache.vocab).find(selectString).toArray(),$(list).attr("repeat"));$(div).find("button.learnlist-button").each(function(index){var word=sampleFromPool();var nNum=$(list).attr("numbers")?$(list).attr("numbers").split(" "):
[""];var nArt=$(list).attr("articles")?$(list).attr("articles").split(" "):[""]})};var title=$(xml).find("title").text();var div=$('<div data-role = "collapsible" class = "ui-body"></div>').append($("<h4>"+title+"</h4>"));var learndiv=$('<div class = "ui-grid-b ui-responsive"></div>').attr("id","VL-learn-div");switch($(xml).attr("learntype")){case "learnlist":createLearnList(learndiv,xml);setLearnList(learndiv,xml);break;case "":break}learndiv.appendTo(div);$("<div data-role='controlgroup' data-type='vertical'></div>").append($("<button class = 'VL-list-reset ui-btn'>Reset</button>").on("click",
function(){setLearnList(learndiv,xml)})).appendTo(div);$(div).appendTo("#VL-lesson")};var createQuiz=function(xml){var createRandomNumberQuiz=function(quizdiv,xml){var quiz=$(xml).find("quiz");var multiples=parseInt($(quiz).attr("multiples"));if(!multiples)multiples=1;var from=Math.floor(parseInt($(quiz).attr("from"))/multiples);var to=Math.floor(parseInt($(quiz).attr("to"))/multiples);var count=parseInt($(xml).attr("count"));var pool=0;if($(quiz).attr("repeat")=="false"){pool=Array(to-from+1);for(i=
0;i<pool.length;i++)pool[i]=(from+i)*multiples}for(i=0;i<count;i++){var num=0;if($(quiz).attr("repeat")=="false")num=pool.splice(selectRandomInteger(0,pool.length),1);else num=selectRandomInteger(from,to);$("<div></div>").attr("class","ui-block-"+letters[i%3]).append(createCard(i+1,createQuizQuestion(num,num))).appendTo(quizdiv)}};var createRandomWordsQuiz=function(quizdiv,xml){var count=parseInt($(xml).attr("count"));var jSentence=$(xml).find("sentence");for(i=0;i<count;i++){var jResolvedSentence=
resolveFrenchSentence(jSentence);var foreignword=parseFrenchSentence(jResolvedSentence,$());var englishword=parseEnglishSentence(jResolvedSentence,$());console.log(foreignword,englishword);$("<div></div>").attr("class","ui-block-"+letters[i%3]).append(createCard(i+1,createQuizQuestion(foreignword,englishword))).appendTo(quizdiv)}};var createNormalQuiz=function(quizdiv,xml){var count=parseInt($(xml).attr("count"));var sampleFromPool=createPool($(xml).find("qblock").toArray());for(i=0;i<count;i++){var qblock=
sampleFromPool();var qs=$(qblock).find("question").toArray();var question=$(selectRandomArrayElem(qs));$("<div></div>").attr("class","ui-block-"+letters[i%3]).append(createCard(i+1,createQuizQuestion(question.text(),question.attr("en")))).appendTo(quizdiv)}};var createQuizQuestion=function(fr,en){var ansTextBox=$('<input type = "text"/>').attr("id","VL-useranswer").attr("data-clear-btn","false");var jButton=$('<button class = "VL-playfrench">Play</button>').attr("value",fr);var ctrlgrp=$('<div data-role = "controlgroup" data-type = "vertical" class = "VL-quiz-question-box"></div>').attr("sol",
en).attr("state","");ctrlgrp.append(jButton).append(ansTextBox);return ctrlgrp};var intiMarkingSequence=function(list){var firstWrongAnswer=0;var markQuestion=function(cur){ttsChrome($(cur).find("button.VL-playfrench").val());if($(cur).find("#VL-useranswer").val().toUpperCase()==$(cur).attr("sol").toUpperCase()){$(cur).parent().animate({backgroundColor:"lime"},200);$(cur).find("#VL-useranswer").attr("disabled","disabled");$(cur).attr("state","done");USER[lessonID]=USER[lessonID]+5}else{$(cur).parent().animate({"background-color":"red"},
200);if(firstWrongAnswer==0)firstWrongAnswer=cur}};var recursive=function(list){if(list.length==0){if(firstWrongAnswer==0)ttsChrome("Tr\u00e8s bien!");else $("html, body").animate({scrollTop:$(firstWrongAnswer).offset().top-100},1E3);return}var cur=list.shift();if($(cur).attr("state")=="done"){recursive(list);return}$("html, body").animate({scrollTop:$(cur).offset().top-100},1E3);setTimeout(function(){markQuestion(cur);setTimeout(function(){recursive(list)},500)},1E3)};return recursive(list)};var title=
$(xml).find("title").text();var div=$('<div data-role = "collapsible" class = "ui-body"></div>').append($("<h4>"+title+"</h4>"));var quizdiv=$('<div class = "ui-grid-b ui-responsive"></div>').attr("id","VL-quiz-div");switch($(xml).attr("quiztype")){case "random numbers":createRandomNumberQuiz(quizdiv,xml);break;case "random words":createRandomWordsQuiz(quizdiv,xml);break;case "":createNormalQuiz(quizdiv,xml);break}quizdiv.appendTo(div);$("<div data-role='controlgroup' data-type='vertical'></div>").append($("<button class = 'VL-quiz-submit ui-btn'>Submit</button>").on("click",
function(){intiMarkingSequence(quizdiv.find("div.VL-quiz-question-box").toArray())})).appendTo(div);$(div).appendTo("#VL-lesson")};var createConvo=function(xml,exercise){var createConvoSessionAnswers=function(fieldSetAns,exercise,count){fieldSetAns.empty();for(i=0;i<count;i++){var jBtn=$('<input type = "radio" class = "VL-playfrench play-answer"/>').attr("name","convo-"+exercise).attr("id","convo-"+exercise+"-"+i).on("click",function(){ttsChrome($(this).attr("value"))});var jLab=$("<label>Play Answer "+
(i+1)+"</label>").attr("for","convo-"+exercise+"-"+i);fieldSetAns.append(jBtn).append(jLab)}};var setConvoSession=function(thisdiv,exercise,qna,global){var question=$(qna).find("question");var answer=$(qna).find("answer");var falseans=$(qna).find("falseans");var correct=$(qna).find("correct");createConvoSessionAnswers($(thisdiv).find("fieldset.convo-answer-field"),exercise,parseInt($(qna).attr("answers")));var truth=Array(parseInt($(qna).attr("answers")));truth[0]=parseFrenchSentence(answer.clone(),
global,true);truth[1]=parseFrenchSentence(answer.clone(),global,false);for(i=2;i<truth.length;i++)if(falseans)truth[i]=parseFrenchSentence(falseans.clone(),global,false);else truth[i]=parseFrenchSentence(answer.clone(),global,false);var samepleFromPool=createPool(truth,false);$(thisdiv).find("button.play-question").attr("value",parseFrenchSentence(question.clone(),global,true));$(thisdiv).find("input.play-answer").each(function(){$(this).attr("value",samepleFromPool())});$(thisdiv).find("button.VL-submitConvo").attr("correct",
parseFrenchSentence(correct.clone(),global,true)).attr("value",truth[0])};var title=$(xml).find("title").text();var div=$('<div data-role = "collapsible" class = "ui-body"></div>').append($("<h4>"+title+"</h4>"));var quizdiv=$('<div class = "ui-grid-b ui-responsive"></div>').attr("id","VL-quiz-div");var qnaArray=$(xml).find("qna").toArray();var global;var questionNumber=0;$("<div data-role='controlgroup' data-type='vertical'></div>").append($('<button class = "VL-playfrench play-question">Play Question</button>')).append($('<fieldset class = "convo-answer-field"></fieldset>')).append($("<button class = 'VL-submitConvo'>Submit</button>").on("click",
function(){if($(this).attr("value")==$("input[name = 'convo-"+exercise+"']:checked").attr("value")){ttsChrome("tres bien!");ttsChrome($(this).attr("correct"));setTimeout(function(){if(qnaArray.length!=0){setConvoSession(quizdiv,exercise,qnaArray.shift(),global);questionNumber=questionNumber+1;$(div).find("div.ui-bar").text("Question "+(questionNumber+1));quizdiv.trigger("create")}else;},2E3);USER[lessonID]=USER[lessonID]+5}else ttsChrome("mal!")})).append($("<button class = ''>Reset</button>").on("click",
function(){qnaArray=$(xml).find("qna").toArray();global=selectRandomGlobals($(xml).find("randomglobal"));setConvoSession(quizdiv,exercise,qnaArray.shift(),global);questionNumber=0;$(div).find("div.ui-bar").text("Question "+(questionNumber+1));quizdiv.trigger("create")})).appendTo(quizdiv);createCard("Question "+(questionNumber+1),quizdiv).appendTo(div);$(div).appendTo("#VL-lesson");global=selectRandomGlobals($(xml).find("randomglobal"));setConvoSession(quizdiv,exercise,qnaArray.shift(),global)}})();(function(){populateCourseList=function(xml){var populateCourse=function(index){respDiv=$('<div class = "ui-grid-d ui-responsive"></div>');$(this).find("module").each(function(index){var moduleID=$(this).attr("id");var moduleName=$(this).attr("name");respDiv.append(createBlock(letters[index%5],createModuleCard($(this),moduleID,moduleName)));appendTempPage("module",moduleID)});var course=$('<div data-role = "collapsible"></div>').append($("<h4>"+$(this).attr("name")+"</h4>")).append(respDiv).appendTo($("div#CourseList"))};
var createModuleCard=function(jModule,id,name){var modBody=$("<div data-role='controlgroup' data-type='vertical'></div>").append($("<p></p>").text("This module consists of "+jModule.children("lesson").size()+" lesson(s).")).append($("<a class = 'ui-btn'>Go To Module</a>").attr("href","#module_"+id));var card=createCard(name,modBody);card.find("div.ui-bar").attr("style","font-size:10pt");return card};$("div#CourseList").empty();$(xml).find("course").each(populateCourse)};populateModulePage=function(xml,
id){var populateLessonBox=function(index){var populateLessonCard=function(index,jLesson,lessonName,lessonID,lessonType){if(typeof USER[lessonID]=="undefined")USER[lessonID]=TEMPLATE_USER_LESSON;var card=createCard(lessonName,$(""));card.find("div.ui-bar").attr("style","font-size:10pt");$("#LessonList").append(createBlock(letters[index%3],card));var jLesson=$($(xmlCache.lessons).find("lesson#"+lessonID));card.find("div.ui-body").append($("<div data-role='controlgroup' data-type='vertical'></div>").append($("<div class='ui-grid-a'></div>").append("<div class='ui-block-a'>Exercises: </div>").append("<div class='ui-block-b'>"+
jLesson.children("exercise").size()+"</div>").append("<div class='ui-block-a'>Success: </div>").append("<div class='ui-block-b'>"+USER[lessonID].timesCompleted+"/"+USER[lessonID].timesAttempted+"</div>").append("<div class='ui-block-a'>Score: </div>").append("<div class='ui-block-b'>"+USER[lessonID].score+"</div>")).append($("<a class = 'ui-btn'>Go to Lesson</a>").attr("href","#lesson_"+lessonID)));card.find("div.ui-bar").attr("style","font-size:10pt")};var lessonName=$(this).attr("name");var lessonID=
$(this).attr("id");var lessonType=$(this).attr("type");populateLessonCard(index,$(this),lessonName,lessonID,lessonType);appendTempPage("lesson",lessonID)};$("#LessonList").empty();var xmlModule=$(xml).find("module#"+id);$("h2#ModuleTitle").text($(xmlModule).attr("name"));xmlCache.get("lessons",function(){$(xmlModule).find("lesson").each(populateLessonBox)})}})();(function(){initQuickLesson=function(){var setupQuickLesson=function(){xmlCache.get("quick",function(xmlQuick){xmlCache.get("vocab",function(xmlVocab){setupQLQuestion(xmlQuick)})})};var randomizeList=function(list){var j,x,i;for(i=list.length;i;i--){j=Math.floor(Math.random()*i);x=list[i-1];list[i-1]=list[j];list[j]=x}return list};var setupQLQuestion=function(xml){var setQLQuestion=function(instr,playText,answerText,b1Text,b2Text,b3Text,responseCorrect,responseWrong){$("#QL-statsbox").text("Questions Answered Correctly: "+
$("#QL-stats-numCorrect").val()+"/"+$("#QL-stats-numQuestions").val());$("#QL-questiontext").text(instr);$("button#QL-playSound").attr("value",playText);$("div#quicklesson").attr("correct-answer",answerText);var buttons=randomizeList([$("a#QL-b1"),$("a#QL-b2"),$("a#QL-b3")]);buttons[0].text(b1Text);buttons[1].text(b2Text);buttons[2].text(b3Text);$("div#quicklesson").attr("on-wrong-answer",ifExistsElse(responseWrong),"Wrong Answer!");$("div#quicklesson").attr("on-correct-answer",ifExistsElse(responseCorrect),
"Correct Answer!")};var falseAnswers=function(inOut,jAns){for(i=0;i<2;i++){var ans=inOut[0];for(j=0;j<100;j++)if(inOut.indexOf(ans)!=-1)ans=parseEnglishSentence(resolveFrenchSentence(jAns,selectRandomGlobals(jQuestion.find("randomglobal"))));else break;inOut.push(ans)}return inOut};var jXML=$(xml);var gamesList=jXML.find("game");if($("select#QL-lessontype").val()!="QL-random")gamesList=gamesList.filter("."+$("select#QL-lessontype").val());var jGame=$(selectRandomArrayElem(gamesList));var jQuestion=
$(jGame.parent());var jSentence=$(selectRandomArrayElem(jQuestion.find("sentence")));var global=selectRandomGlobals(jQuestion.find("randomglobal"));var jResolvedSentence=$(resolveFrenchSentence($(jSentence),global));var jAnswer=jGame.find("ans");var jAnswerRandom=jAnswer.clone();jAnswerRandom.find("parse").removeAttr("src");var answer=falseAnswers([parseEnglishSentence(copyFrenchSentence(jAnswer,global,jResolvedSentence))],jAnswerRandom);setQLQuestion(jGame.children("instructions").text(),parseFrenchSentence(jResolvedSentence),
answer[0],answer[0],answer[1],answer[2])};var answerQLQuestion=function(btn){$("div#quicklesson").attr("stats-num-questions",parseInt($("div#quicklesson").attr("stats-num-questions"))+1);if($(btn).text()==$("div#quicklesson").attr("correct-answer")){$("div#quicklesson").attr("stats-num-correct",parseInt($("div#quicklesson").attr("stats-num-correct"))+1);$("#QL-result-headertext").text("Correct!");$("#QL-result-messagetext").text($("div#quicklesson").attr("on-correct-answer"));$(btn).animate({"backgroundColor":"lime"},
400)}else{$("#QL-result-headertext").text("Wrong!");$("#QL-result-messagetext").text($("div#quicklesson").attr("on-wrong-answer"));$(btn).animate({"backgroundColor":"red"},400)}};$(document).on("pagebeforeshow","#quicklesson",function(event,data){setupQuickLesson(event,data);$("div#quicklesson").attr("stats-num-questions",0);$("div#quicklesson").attr("stats-num-correct",0)});$("button#QL-playSound").on("click",function(e){ttsChrome($(this).attr("value"))});$("button#QL-playSound-slow").on("click",
function(e){ttsChrome($("button#QL-playSound").attr("value"),GLOBAL_VARIABLES.voiceSpeedSlow)});$("a.QL-option").on("click",function(e){answerQLQuestion(this)});$("select#QL-lessontype").on("change",function(e){setupQuickLesson()});$("div#QL-result").bind("popupafterclose",function(e){setupQuickLesson()});$("button#QL-skip-question").on("click",function(e){setupQuickLesson()});$("select#QL-lessontype").trigger("create")}})();(function(){var selectFromOptions=function(jObj,jSrc,attrib,otherwise){if(typeof jSrc.attr(attrib)=="undefined")jObj.attr(attrib,selectRandomArrayElem(otherwise));else jObj.attr(attrib,selectRandomArrayElem(jSrc.attr(attrib).split(" ")))};var setParseBlock=function(jDest,jSrc){selectFromOptions(jDest,jSrc,"gender",["m","f"]);selectFromOptions(jDest,jSrc,"person",["1","2","3"]);selectFromOptions(jDest,jSrc,"number",["sing","plur"]);selectFromOptions(jDest,jSrc,"tense",["present"]);selectFromOptions(jDest,
jSrc,"mood",["indicative"]);selectFromOptions(jDest,jSrc,"type",["def","indef","par"])};var parseGlobals=function(randomGlobal,sentence){$(randomGlobal).each(function(){$(sentence).find("global[name = "+$(this).attr("id")+"]").filter(":not([eng])").replaceWith($(this).html());$(sentence).find("global[name = "+$(this).attr("id")+"]").filter("[eng]").replaceWith($(this).attr("eng"))})};selectRandomGlobals=function(randomGlobal){var global=$(randomGlobal).clone();$(global).each(function(){var arr=$(this).find("g");
var jChoice=$(selectRandomArrayElem(arr));$(this).html(jChoice.html());$(this).attr("eng",ifExistsElse(jChoice.attr("eng"),""))});return global};copyFrenchSentence=function(inSentence,randomglobal,srcSentence){sentence=inSentence.clone();parseGlobals(randomglobal,sentence);var copyWords=function(jParseXML,jSrcParseXML){jParseXML.find("verb").each(function(){$(this).attr("inf",jSrcParseXML.children("verb").attr("inf"));jParseXML.attr("vowel",jSrcParseXML.attr("vowel"))});jParseXML.find("noun").each(function(){$(this).attr("sing",
jSrcParseXML.children("noun").attr("sing"))});jParseXML.find("number").each(function(){$(this).attr("num",jSrcParseXML.children("number").attr("num"))})};$(sentence).find("parse").filter("[src]").each(function(){setParseBlock($(this),$($(srcSentence).find("parse").filter("[id = '"+$(this).attr("src")+"']")));copyWords($(this),$($(srcSentence).find("parse").filter("[id = '"+$(this).attr("src")+"']")))});return sentence};resolveFrenchSentence=function(inSentence,randomglobal){sentence=inSentence.clone();
parseGlobals(randomglobal,sentence);$(sentence).find("op").each(function(){var arr=$(this).html().split("|");$(this).replaceWith(selectRandomArrayElem(arr))});var resolveWords=function(jParseXML,jSrcParseXML){jParseXML.find("verb").each(function(){var jVerb=$(selectRandomArrayElem($(xmlCache.vocab).find("verb").filterWithClass($(this),"category").filterWithAttr($(this),"inf")));$(this).attr("inf",jVerb.attr("inf"));jParseXML.attr("vowel",jVerb.attr("vowel"))});jParseXML.find("noun").each(function(){var jNoun=
$(selectRandomArrayElem($(xmlCache.vocab).find("noun").filterWithClass($(this),"category").filterWithAttr($(this),"sing").filterWithAttr($(this),"gender")));$(this).attr("sing",jNoun.attr("sing"))});jParseXML.find("number").each(function(){if(typeof $(this).attr("num")=="undefined")$(this).attr("num",selectRandomInteger($(this).attr("from"),$(this).attr("to")))})};$(sentence).find("parse").filter(":not([src])").each(function(){setParseBlock($(this),$(this))});$(sentence).find("parse").filter("[src]").each(function(){setParseBlock($(this),
$($(sentence).find("parse").filter("[id = '"+$(this).attr("src")+"']")))});$(sentence).find("parse").each(function(){resolveWords($(this),$(this))});return sentence};parseFrenchSentence=function(inSentence){sentence=inSentence.clone();$(sentence).find("parse").each(function(){var jParseXML=$(this);$(this).find("if").each(function(){if(jParseXML.children($(this).attr("search")).size()!=0)$(this).replaceWith($(this).attr("yes"));else $(this).replaceWith($(this).attr("no"))});$(sentence).find("noun").each(function(){var jWord=
$($(xmlCache.vocab).find("noun").filterWithAttr($(this),"sing")).clone();$(this).replaceWith(parseNounFrench(jWord,jParseXML))});$(this).find("pronoun").each(function(){var attrib="fr-"+jParseXML.attr("person");if(jParseXML.attr("person")=="3")attrib=attrib+jParseXML.attr("gender");var pro=$(xmlCache.vocab).find("pronoun").find("personal").find(jParseXML.attr("number")).attr(attrib);if(jParseXML.attr("vowel")=="true")$(pro).children("v").replaceWith("");else $(pro).children("v").replaceWith(function(){$(this).text()});
$(this).replaceWith(pro)});$(sentence).find("verb").each(function(){var jWord=$($(xmlCache.vocab).find("verb").filterWithAttr($(this),"inf")).clone();$(this).replaceWith(parseVerbFrench(jWord,jParseXML))});$(this).find("article").each(function(){var art=$(xmlCache.vocab).find("article#"+jParseXML.attr("type")).children(jParseXML.attr("gender")).children(jParseXML.attr("number")).clone();if(jParseXML.attr("vowel")=="true")$(art).children("v").replaceWith("");$(this).replaceWith(art)});$(this).find("number").each(function(){$(this).replaceWith($(this).attr("num"))})});
var str=$.map($(sentence).find("parse"),function(par){return $(par).text()}).join(" ");return str};parseVerbFrench=function(jXMLVerb,jXMLparse){var conj=jXMLVerb.attr("conj")=="irregular"?getConjugation(jXMLVerb,jXMLparse):getConjugation($(xmlCache.vocab).find("verbpattern#"+$(jXMLVerb).attr("conj")),jXMLparse);if(jXMLVerb.attr("conj")=="irregular")return $(conj).attr("fr-"+jXMLparse.attr("person"));return jXMLVerb.attr("stem")+$(conj).attr("fr-"+jXMLparse.attr("person"))};parseNounFrench=function(jXMLVerb,
jXMLparse){switch(jXMLparse.attr("number")){case "sing":return jXMLVerb.attr("sing");break;case "plur":if(jXMLVerb.attr("plur")=="")return jXMLVerb.attr("sing")+"s";else return jXMLVerb.attr("plur");break}};var getConjugation=function(jXMLVerb,jXMLparse){var xmlMood=jXMLVerb.find(jXMLparse.attr("mood"));var xmlTense=$(xmlMood).find(jXMLparse.attr("tense"));return $(xmlTense).find(jXMLparse.attr("number"))};parseEnglishSentence=function(inSentence){sentence=inSentence.clone();$(sentence).find("parse").each(function(){var jParseXML=
$(this);$(this).find("if").each(function(){if(jParseXML.children($(this).attr("search")).size()!=0)$(this).replaceWith($(this).attr("yes"));else $(this).replaceWith($(this).attr("no"))});$(sentence).find("noun").each(function(){var jWord=$($(xmlCache.vocab).find("noun").filterWithAttr($(this),"sing")).clone();$(this).replaceWith(parseNounEnglish(jWord,jParseXML))});$(this).find("pronoun").each(function(){var attrib="en-"+jParseXML.attr("person");if(jParseXML.attr("person")=="3")attrib=attrib+jParseXML.attr("gender");
var pro=$(xmlCache.vocab).find("pronoun").find("personal").find(jParseXML.attr("number")).attr(attrib);$(this).replaceWith(pro)});$(sentence).find("verb").each(function(){var jWord=$($(xmlCache.vocab).find("verb").filterWithAttr($(this),"inf")).clone();$(this).replaceWith(parseVerbEnglish(jWord,jParseXML))});$(this).find("article").each(function(){var art=$(xmlCache.vocab).find("article#"+jParseXML.attr("type")).children("eng").children(jParseXML.attr("number")).clone();if(jParseXML.attr("vowel")==
"true")$(art).children("v").replaceWith("");$(this).replaceWith(art)});$(this).find("number").each(function(){$(this).replaceWith($(this).attr("num"))})});var str=$.map($(sentence).find("parse"),function(par){return $(par).text()}).join(" ");return str};parseNounEnglish=function(jXMLVerb,jXMLparse){switch(jXMLparse.attr("number")){case "sing":return jXMLVerb.attr("en-sing");break;case "plur":if(jXMLVerb.attr("plur")=="")return jXMLVerb.attr("en-sing")+"s";else return jXMLVerb.attr("en-plur");break}};
parseVerbEnglish=function(jXMLVerb,jXMLparse){var jXMLVocabVerb=$($(xmlCache.vocab).find("verb").filterWithAttr(jXMLVerb,"inf"));var conj=jXMLVocabVerb.attr("conj")=="irregular"?getConjugation(jXMLVocabVerb,jXMLparse):getConjugation($(xmlCache.vocab).find("verbpattern#"+$(jXMLVocabVerb).attr("conj")),jXMLparse);if(jXMLVerb.attr("conj")=="irregular")return $(conj).attr("en-"+jXMLparse.attr("person"));if(jXMLparse.attr("person")=="3")if(jXMLVocabVerb.attr("en-3")=="")return jXMLVocabVerb.attr("en-1")+
"s";else return jXMLVocabVerb.attr("en-3");return $(conj).attr("en-1")}})();
